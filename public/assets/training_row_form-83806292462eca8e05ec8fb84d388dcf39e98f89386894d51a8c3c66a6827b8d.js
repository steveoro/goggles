function setupWidgets(){$(".jspinner").spinner(),initGroupHeadersVisibility(),initDroppables($(".droppable")),initSortables($(".sortable"))}function initGroupHeadersVisibility(){var t=$(".group_id"),e=$(".data_row"),i={};t.each(function(n,s){var r=Number(s.value);if(r>0){var a=e.eq(n),o=a.closest(".group_detail").parent();if(i[String(r)]>=0){var l=i[r],h=t.eq(l).closest(".group_hdr"),c=h.siblings(".group_detail").first();a.find(".ungrouped-row-controls").hide(),a.closest(".group_detail").removeClass("droppable"),o.appendTo(c)}else{var u=t.eq(n),h=u.closest(".group_hdr"),c=h.siblings(".group_detail").first();h.show(),o.addClass("grouped"),a.find(".ungrouped-row-controls").hide(),i[r]=n}}})}function initAutocomplete(){$(".exercise-autocomplete").autocomplete({source:function(t,e){var i=$(this).closest(".data_row"),n=i.find(".training_step_type");console.log("trainingStepType:"),console.log(n);var s=n.val();console.log("Selected: ID="+s),$.ajax({url:exerciseAutocompleteURL,dataType:"json",data:{training_step_type_id:s,query:t.term}}).done(function(t){e(t)})},select:function(t,e){return this.value=e.item.label,console.log("ui.item:"),console.log(e.item),this.parentElement.firstElementChild.firstElementChild.value=e.item.value,console.log(e),!1},minLength:1})}function initDroppables(t){$(t).droppable({greedy:!0})}function initSortables(t){t.sortable({placeholder:"ui-state-highlight",items:".full_row",connectWith:".droppable",opacity:.8,start:function(t,e){e.placeholder.height(e.item.height()+5),$initialDragParent=e.item.parent()},receive:function(t,e){e.item.hasClass("grouped")&&(alert("We cannot create nested groups!"),$(e.sender).sortable("cancel"))},beforeStop:updateAutoSeq,stop:function(t,e){$initialDragParent.hasClass("group_detail")&&0==$initialDragParent.children(".full_row").length&&makeUngroup($initialDragParent),e.item.parent().hasClass("group_detail")?makeGroup(e.item):promoteToDroppable(e.item),initDroppables($(".droppable")),initSortables($(".sortable"))}})}function updateAutoSeq(){var t=$("input.autosequence");t.each(function(t,e){e.value=t+1})}function makeGroup(t){t.find("> .group_detail").removeClass("droppable");var e=t.parent(),i=t.parent().parent(),n=i.find(".autosequence").first();i.find(".group_id").val(n.val()),i.find(".group_times").val(2),e.siblings(".group_hdr").show(),console.log("[makeGroup]: targetDroppable: >> GROUPED!"),console.log(e),i.addClass("grouped"),i.find(".ungrouped-row-controls").hide()}function makeUngroup(t){t.siblings(".group_hdr").hide(),console.log("[makeUngroup]: $item.parent(): ** UNGROUPED!"),console.log(t.parent()),t.parent().removeClass("grouped"),t.find(".ungrouped-row-controls").show()}function promoteToDroppable(t){console.log("[promoteToDroppable]: $item:"),console.log(t),t.find("> .group_detail").addClass("droppable"),t.find(".ungrouped-row-controls").show()}function clickBreakGrouping(t){console.log("[clickBreakGrouping]: $item:"),console.log(t),t.find(".group_clear").each(function(t,e){$(e).val(0)});var e=t.find(".group_detail");e.each(function(t,e){makeUngroup($(e))});var i=t.find(".full_row");i.each(function(e,i){promoteToDroppable($(i)),$(i).insertAfter(t)})}function setAuxVisibilityByAjaxData(t,e){e.is_arm_aux_allowed?$(t).closest(".data_row").find(".arm_aux_type").show():$(t).closest(".data_row").find(".arm_aux_type").hide(),e.is_kick_aux_allowed?$(t).closest(".data_row").find(".is_kick_aux_allowed").show():$(t).closest(".data_row").find(".is_kick_aux_allowed").hide(),e.is_body_aux_allowed?$(t).closest(".data_row").find(".is_body_aux_allowed").show():$(t).closest(".data_row").find(".is_body_aux_allowed").hide(),e.is_breath_aux_allowed?$(t).closest(".data_row").find(".is_breath_aux_allowed").show():$(t).closest(".data_row").find(".is_breath_aux_allowed").hide()}function getSingleExerciseDescByAjax(t,e){$.ajax({url:exerciseAutocompleteURL,dataType:"json",data:{id:t}}).done(function(t){e.value=t.label,setAuxVisibilityByAjaxData(e,t)})}var maxSeq=Number($("#maxPartOrder").attr("data-value")),$initialDragParent=!1,readyFunct=function(){setupWidgets(),$("#training_rows").on("cocoon:before-remove",function(t,e){$(this).data("remove-timeout",1e3),e.fadeOut("slow")}).on("cocoon:after-insert",function(){updateAutoSeq(),setupWidgets()}).on("cocoon:after-remove",function(){updateAutoSeq()})};$(document).on("turbolinks:load",readyFunct);