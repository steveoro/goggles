!function(t){var e=0,i=function(){return(new Date).getTime()+e++},n=function(t){return"["+t+"]$1"},r=function(t){return"_"+t+"_$1"},s=function(e,i,n){return e?"function"==typeof e?(i&&console.warn("association-insertion-traversal is ignored, because association-insertion-node is given as a function."),e(n)):"string"==typeof e?i?n[i](e):"this"==e?n:t(e):void 0:n.parent()};t(document).on("click",".add_fields",function(e){e.preventDefault();var a=t(this),o=a.data("association"),l=a.data("associations"),h=a.data("association-insertion-template"),c=a.data("association-insertion-method")||a.data("association-insertion-position")||"before",u=a.data("association-insertion-node"),d=a.data("association-insertion-traversal"),p=parseInt(a.data("count"),10),f=new RegExp("\\[new_"+o+"\\](.*?\\s)","g"),g=new RegExp("_new_"+o+"_(\\w*)","g"),m=i(),v=h.replace(f,n(m)),b=[];for(v==h&&(f=new RegExp("\\[new_"+l+"\\](.*?\\s)","g"),g=new RegExp("_new_"+l+"_(\\w*)","g"),v=h.replace(f,n(m))),v=v.replace(g,r(m)),b=[v],p=isNaN(p)?1:Math.max(p,1),p-=1;p;)m=i(),v=h.replace(f,n(m)),v=v.replace(g,r(m)),b.push(v),p-=1;var y=s(u,d,a);y&&0!=y.length||console.warn("Couldn't find the element to insert the template. Make sure your `data-association-insertion-*` on `link_to_add_association` is correct."),t.each(b,function(e,i){var n=t(i);y.trigger("cocoon:before-insert",[n]);y[c](n);y.trigger("cocoon:after-insert",[n])})}),t(document).on("click",".remove_fields.dynamic, .remove_fields.existing",function(e){var i=t(this),n=i.data("wrapper-class")||"nested-fields",r=i.closest("."+n),s=r.parent();e.preventDefault(),s.trigger("cocoon:before-remove",[r]);var a=s.data("remove-timeout")||0;setTimeout(function(){i.hasClass("dynamic")?r.remove():(i.prev("input[type=hidden]").val("1"),r.hide()),s.trigger("cocoon:after-remove",[r])},a)}),t(document).on("ready page:load",function(){t(".remove_fields.existing.destroyed").each(function(){var e=t(this),i=e.data("wrapper-class")||"nested-fields";e.closest("."+i).hide()})})}(jQuery);