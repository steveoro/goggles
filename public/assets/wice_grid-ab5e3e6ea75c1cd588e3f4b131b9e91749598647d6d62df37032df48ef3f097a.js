(function(){var t;t=function(){function t(t,e,i,n,r,s,a){this.name=t,this.baseRequestForFilter=e,this.baseLinkForShowAllRecords=i,this.linkForExport=n,this.parameterNameForQueryLoading=r,this.parameterNameForFocus=s,this.environment=a,this.filterDeclarations=new Array,this.checkIfJsFrameworkIsLoaded()}return t.prototype.checkIfJsFrameworkIsLoaded=function(){if(!jQuery)return alert("jQuery not loaded, WiceGrid cannot proceed!")},t.prototype.toString=function(){return"<WiceGridProcessor instance for grid '"+this.name+"'>"},t.prototype.process=function(t){return this.visit(this.buildUrlWithParams(t))},t.prototype.visit=function(t){return"undefined"!=typeof Turbolinks&&null!==Turbolinks?Turbolinks.visit(t):window.location=t},t.prototype.setProcessTimer=function(t){var e;return this.timer&&(clearTimeout(this.timer),this.timer=null),e=this,this.timer=setTimeout(function(){return e.process(t)},1e3)},t.prototype.reloadPageForGivenGridState=function(t){var e;return e=this.gridStateToRequest(t),this.visit(this.appendToUrl(this.baseLinkForShowAllRecords,e))},t.prototype.gridStateToRequest=function(t){return jQuery.map(t,function(t){return encodeURIComponent(t[0])+"="+encodeURIComponent(t[1])}).join("&")},t.prototype.appendToUrl=function(t,e){var i;return i=t.indexOf("?")!==-1?/[&\?]$/.exec(t)?"":"&":"?",t+i+e},t.prototype.buildUrlWithParams=function(t){var e,i,n;return n=new Array,jQuery.each(this.filterDeclarations,function(t){return function(e,i){var r;if(r=t.readValuesAndFormQueryString(i.filterName,i.detached,i.templates,i.ids),r&&""!==r)return n.push(r)}}(this)),i=this.baseRequestForFilter,0!==n.length&&(e=n.join("&"),i=this.appendToUrl(i,e)),t&&(i=this.appendToUrl(i,this.parameterNameForFocus+t)),i},t.prototype.reset=function(){return this.visit(this.baseRequestForFilter)},t.prototype.exportToCsv=function(){return this.visit(this.linkForExport)},t.prototype.register=function(t){return this.filterDeclarations.push(t)},t.prototype.readValuesAndFormQueryString=function(t,e,i,n){var r,s,a,o,l,h,c,u,d,p;for(d=new Array,s=o=0,c=i.length-1;0<=c?o<=c:o>=c;s=0<=c?++o:--o){if(null===$(n[s]))return"development"===this.environment&&(h='WiceGrid: Error reading state of filter "'+t+'". No DOM element with id "'+n[s]+'" found.',e&&(h+='You have declared "'+t+'" as a detached filter but have not output it anywhere in the template. Read documentation about detached filters.'),alert(h)),"";if(r=$("#"+n[s]),r[0]&&"checkbox"===r[0].type?r[0].checked&&(p=1):p=r.val(),p instanceof Array)for(a=l=0,u=p.length-1;0<=u?l<=u:l>=u;a=0<=u?++l:--l)p[a]&&""!==p[a]&&d.push(i[s]+encodeURIComponent(p[a]));else p&&""!==p&&d.push(i[s]+encodeURIComponent(p))}return d.join("&")},t}(),t._version="3.4",window.WiceGridProcessor=t}).call(this),function(){var t,e,i,n,r,s,a,o,l,h,c,u,d,p,f,g,m,v,b,y;$(document).on("turbolinks:load",function(){return r()}),n="wiceGrids",r=function(){return $(".wice-grid-container").each(function(t,i){var r,s,a,o,h,d,p,f,m;for(h=i.id,r=$(".wg-data",i),m=r.data("processor-initializer-arguments"),a=r.data("filter-declarations"),e(r.data("foc")),d=new WiceGridProcessor(h,m[0],m[1],m[2],m[3],m[4],m[5]),o=function(t){if(null!=t)return d.register({filterName:t.filterName,detached:t.detached,templates:t.declaration.templates,ids:t.declaration.ids})},p=0,f=a.length;p<f;p++)s=a[p],o(s);return window[n]||(window[n]={}),window[n][h]=d,y(i,d),u(i,d),g(i),b(i,d),v(i),l(i,d),c(i)}),o(),f(),p(),d(),v($(".wg-detached-filter"))},a=function(t,e,i,n,r){var s,a,o,l;if((a=e.data(t))&&(l=$(s="#"+a))&&(o=l.datepicker("getDate"))&&r(o,i))return l.datepicker("setDate",i),l.next().next().html($.datepicker.formatDate(n,i))},d=function(){if(0!==$(".date-filter.wg-jquery-datepicker").length&&m(),0!==$(".date-filter.wg-bootstrap-datepicker").length)return h()},h=function(){return $.fn.datepicker?$(".date-filter.wg-bootstrap-datepicker input:text[data-provide=datepicker]").each(function(t,e){return $(e).datepicker().on("hide",function(t){var e,i,n;return e=$(t.currentTarget),n=e.data("close-calendar-event-name"),n?e.trigger(n):"fr"===e.attr("id").split("_").pop()&&(i=e.parent().next().find("input:text.check-for-bsdatepicker"),i.length>0)?i.datepicker("show"):void 0})}):void alert("Seems like you do not have Bootstrap datepicker gem (https://github.com/Nerian/bootstrap-datepicker-rails)\ninstalled. Either install it pick another filter with :filter_type.")},m=function(){var t;return $.datepicker||alert("Seems like you do not have jQuery datepicker (http://jqueryui.com/demos/datepicker/)\ninstalled. Either install it pick another filter with :filter_type."),(t=$(".date-filter.wg-jquery-datepicker input[type=hidden]").data("locale"))&&$.datepicker.setDefaults($.datepicker.regional[t]),$(".date-filter.wg-jquery-datepicker .date-label").each(function(t,e){var i,n,r,s,o,l,h,c;return r=$("#"+$(e).data("dom-id")),s=r.data("close-calendar-event-name"),$(e).click(function(t){return $(this).html(""),r.val(""),s&&r.trigger(s),t.preventDefault(),!1}),h=this,i=r.data("date-format"),c=r.data("date-year-range"),o=r.data("button-text"),r.datepicker({firstDay:1,dateFormat:i,changeMonth:!0,changeYear:!0,yearRange:c,onSelect:function(t){var e;if(e=$(this).datepicker("getDate"),a("the-other-datepicker-id-to",r,e,i,function(t,e){return t<e}),a("the-other-datepicker-id-from",r,e,i,function(t,e){return t>e}),$(h).html(t),s)return r.trigger(s)}}),n=r.parent(),$(e).before(' <i class="fa fa-calendar ui-datepicker-trigger" title="'+o+'" ></i> '),l=$(".fa-calendar",n),l.click(function(){return r.datepicker("show")})})},g=function(t){var e,i,n;return i=".wg-hide-filter",n=".wg-show-filter",e=".wg-filter-row",$(i,t).click(function(){return $(this).hide(),$(n,t).show(),$(e,t).hide()}),$(n,t).click(function(){return $(this).hide(),$(i,t).show(),$(e,t).show()})},u=function(t,e){return $(".export-to-csv-button",t).click(function(){return e.exportToCsv()})},y=function(t,e){return $(".submit",t).click(function(){return e.process()}),$(".reset",t).click(function(){return e.reset()}),$(".wg-filter-row input[type=text], .wg-filter-row input:text[data-provide=datepicker]",t).keydown(function(t){if(13===t.keyCode)return t.preventDefault(),e.process()})},t=function(t){var e,i;t.createTextRange?(e=t.createTextRange(),e.moveStart("character",t.value.length),e.collapse(),e.select()):(t.focus(),i=t.value.length,t.setSelectionRange(i,i))},e=function(e){var i,n;if(n=$("#"+e),i=n[0])return t(i)},l=function(t,e){return $("select.auto-reload, input.native-datepicker.auto-reload",t).change(function(){return e.process()}),$("input.auto-reload",t).keyup(function(t){if(s(t.which))return e.setProcessTimer(this.id)}),$("input.negation-checkbox.auto-reload",t).click(function(){return e.process()}),$(document).bind("wg:calendarChanged_"+e.name,function(){return e.process()})},s=function(t){return[37,38,39,40,9,27].indexOf(t)===-1},o=function(){return $(".wg-detached-filter").each(function(t,e){var n;if(n=i(e))return $("select.auto-reload, input.native-datepicker.auto-reload",e).change(function(){return n.process()}),$("input.auto-reload",e).keyup(function(t){if(s(t.which))return n.setProcessTimer(this.id)}),$("input.negation-checkbox.auto-reload",e).click(function(){return n.process()})})},b=function(t,e){return $(".wg-show-all-link, .wg-back-to-pagination-link",t).click(function(t){var i,n,r;return t.preventDefault(),n=$(this).data("grid-state"),i=$(this).data("confim-message"),r=function(){return e.reloadPageForGivenGridState(n)},i?confirm(i)?r():void 0:r()})},v=function(t){return $(".expand-multi-select-icon",t).click(function(){return $(this).prev().each(function(t,e){return e.multiple=!0}),$(this).next().show(),$(this).hide()}),$(".collapse-multi-select-icon",t).click(function(){return $(this).prev().prev().each(function(t,e){return e.multiple=!1}),$(this).prev().show(),$(this).hide()})},c=function(t){return $(".select-all",t).click(function(){return $(".sel input",t).prop("checked",!0).trigger("change")}),$(".deselect-all",t).click(function(){return $(".sel input",t).prop("checked",!1).trigger("change")}),$(".wg-select-all",t).click(function(){return $(".sel input",t).prop("checked",$(this).prop("checked")).trigger("change")})},i=function(t){var e;return e=$(t).data("grid-name"),e&&window[n]?window[n][e]:null},p=function(){return $(".wg-external-csv-export-button").each(function(t,e){var n;if(n=i(e))return $(e).click(function(){return n.exportToCsv()})})},f=function(){return $(".wg-external-submit-button").each(function(t,e){var n;if(n=i(e))return $(e).click(function(t){return n.process(),t.preventDefault(),!1})}),$(".wg-external-reset-button").each(function(t,e){var n;if(n=i(e))return $(e).click(function(t){return n.reset(),t.preventDefault(),!1})}),$(".wg-detached-filter").each(function(t,e){var n;if(n=i(e))return $("input[type=text], input:text[data-provide=datepicker]",this).keydown(function(t){if(13===t.keyCode)return n.process(),t.preventDefault(),!1})})},window.getGridProcessorForElement=i,window.initWiceGrid=r}.call(this),function(){var t,e,i,n,r;$(document).on("turbolinks:load",function(){return r()}),r=function(){return $(".wice-grid-save-query-field").keydown(function(t){if(13===t.keyCode)return n($(this).next(),t)}),$(".wice-grid-save-query-button").click(function(t){return n(this,t)}),$(".wice-grid-delete-query").click(function(e){return t(this,e)}),$(".wice-grid-query-load-link").click(function(t){return e(this,t)})},e=function(t,e){var i,n,r;return(i=window.getGridProcessorForElement(t))&&(n=$(t).data("query-id"),r=i.appendToUrl(i.buildUrlWithParams(),i.parameterNameForQueryLoading+encodeURIComponent(n)),i.visit(r)),e.preventDefault(),e.stopPropagation(),!1},t=function(t,e){var n,r,s;return n=$(t).data("wg-confirm"),s=n?function(){return confirm(n)}:function(){return!0},s()&&(r=window.getGridProcessorForElement(t))&&jQuery.ajax({url:$(t).attr("href"),async:!0,dataType:"json",success:function(t){return i(t,r.name)},type:"POST"}),e.preventDefault(),e.stopPropagation(),!1},n=function(t,e){var n,r,s,a,o,l,h,c;if(s=window.getGridProcessorForElement(t))return n=$(t),r=n.data("base-path-to-query-controller"),a=n.data("parameters"),l=n.data("ids"),o=n.prev(),l instanceof Array&&l.each(function(t){return a.push(["extra["+t+"]",$("#"+t).val()])}),h=o.val(),c=s.gridStateToRequest(a),jQuery.ajax({url:r,async:!0,data:c+"&query_name="+encodeURIComponent(h),dataType:"json",success:function(t){return i(t,s.name,h,o)},type:"POST"}),e.preventDefault(),!1},i=function(i,n,r,s){var a,o,l,h,c;return h="#"+n+"_notification_messages",o="#"+n+"_title",c="#"+n+"_query_list",r&&s.val(""),(a=i.error_messages)?$(h).text(a):((l=i.notification_messages)&&$(h).text(l),r&&$(o).html("<h3>"+r+"</h3>"),$(c).replaceWith(i.query_list),jQuery.ui&&$(c).effect("highlight"),$(".wice-grid-delete-query",$(c)).click(function(e){return t(this,e)}),$(".wice-grid-query-load-link",$(c)).click(function(t){return e(this,t)}))}}.call(this);