!function(t){function e(e){function r(e){k||(k=!0,v=e.getCanvas(),b=t(v).parent(),y=e.getOptions(),e.setData(s(e.getData())))}function s(e){for(var i=0,n=0,r=0,s=y.series.pie.combine.color,a=[],o=0;o<e.length;++o){var l=e[o].data;t.isArray(l)&&1==l.length&&(l=l[0]),t.isArray(l)?!isNaN(parseFloat(l[1]))&&isFinite(l[1])?l[1]=+l[1]:l[1]=0:l=!isNaN(parseFloat(l))&&isFinite(l)?[1,+l]:[1,0],e[o].data=[l]}for(var o=0;o<e.length;++o)i+=e[o].data[0][1];for(var o=0;o<e.length;++o){var l=e[o].data[0][1];l/i<=y.series.pie.combine.threshold&&(n+=l,r++,s||(s=e[o].color))}for(var o=0;o<e.length;++o){var l=e[o].data[0][1];(r<2||l/i>y.series.pie.combine.threshold)&&a.push(t.extend(e[o],{data:[[1,l]],color:e[o].color,label:e[o].label,angle:l*Math.PI*2/i,percent:l/(i/100)}))}return r>1&&a.push({data:[[1,n]],color:s,label:y.series.pie.combine.label,angle:n*Math.PI*2/i,percent:n/(i/100)}),a}function a(e,r){function s(){S.clearRect(0,0,h,c),b.children().filter(".pieLabel, .pieLabelBackground").remove()}function a(){var t=y.series.pie.shadow.left,e=y.series.pie.shadow.top,i=10,n=y.series.pie.shadow.alpha,r=y.series.pie.radius>1?y.series.pie.radius:_*y.series.pie.radius;if(!(r>=h/2-t||r*y.series.pie.tilt>=c/2-e||r<=i)){S.save(),S.translate(t,e),S.globalAlpha=n,S.fillStyle="#000",S.translate(x,w),S.scale(1,y.series.pie.tilt);for(var s=1;s<=i;s++)S.beginPath(),S.arc(0,0,r,0,2*Math.PI,!1),S.fill(),r-=s;S.restore()}}function l(){function e(t,e,i){t<=0||isNaN(t)||(i?S.fillStyle=e:(S.strokeStyle=e,S.lineJoin="round"),S.beginPath(),Math.abs(t-2*Math.PI)>1e-9&&S.moveTo(0,0),S.arc(0,0,r,s,s+t/2,!1),S.arc(0,0,r,s+t/2,s+t,!1),S.closePath(),s+=t,i?S.fill():S.stroke())}function i(){function e(e,i,n){if(0==e.data[0][1])return!0;var s,a=y.legend.labelFormatter,o=y.series.pie.label.formatter;s=a?a(e.label,e):e.label,o&&(s=o(s,e));var l=(i+e.angle+i)/2,u=x+Math.round(Math.cos(l)*r),d=w+Math.round(Math.sin(l)*r)*y.series.pie.tilt,p="<span class='pieLabel' id='pieLabel"+n+"' style='position:absolute;top:"+d+"px;left:"+u+"px;'>"+s+"</span>";b.append(p);var f=b.children("#pieLabel"+n),g=d-f.height()/2,m=u-f.width()/2;if(f.css("top",g),f.css("left",m),0-g>0||0-m>0||c-(g+f.height())<0||h-(m+f.width())<0)return!1;if(0!=y.series.pie.label.background.opacity){var v=y.series.pie.label.background.color;null==v&&(v=e.color);var _="top:"+g+"px;left:"+m+"px;";t("<div class='pieLabelBackground' style='position:absolute;width:"+f.width()+"px;height:"+f.height()+"px;"+_+"background-color:"+v+";'></div>").css("opacity",y.series.pie.label.background.opacity).insertBefore(f)}return!0}for(var i=n,r=y.series.pie.label.radius>1?y.series.pie.label.radius:_*y.series.pie.label.radius,s=0;s<d.length;++s){if(d[s].percent>=100*y.series.pie.label.threshold&&!e(d[s],i,s))return!1;i+=d[s].angle}return!0}var n=Math.PI*y.series.pie.startAngle,r=y.series.pie.radius>1?y.series.pie.radius:_*y.series.pie.radius;S.save(),S.translate(x,w),S.scale(1,y.series.pie.tilt),S.save();for(var s=n,a=0;a<d.length;++a)d[a].startAngle=s,e(d[a].angle,d[a].color,!0);if(S.restore(),y.series.pie.stroke.width>0){S.save(),S.lineWidth=y.series.pie.stroke.width,s=n;for(var a=0;a<d.length;++a)e(d[a].angle,y.series.pie.stroke.color,!1);S.restore()}return o(S),S.restore(),!y.series.pie.label.show||i()}if(b){var h=e.getPlaceholder().width(),c=e.getPlaceholder().height(),u=b.children().filter(".legend").children().width()||0;S=r,k=!1,_=Math.min(h,c/y.series.pie.tilt)/2,w=c/2+y.series.pie.offset.top,x=h/2,"auto"==y.series.pie.offset.left?(y.legend.position.match("w")?x+=u/2:x-=u/2,x<_?x=_:x>h-_&&(x=h-_)):x+=y.series.pie.offset.left;var d=e.getData(),p=0;do p>0&&(_*=n),p+=1,s(),y.series.pie.tilt<=.8&&a();while(!l()&&p<i);p>=i&&(s(),b.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")),e.setSeries&&e.insertLegend&&(e.setSeries(d),e.insertLegend())}}function o(t){if(y.series.pie.innerRadius>0){t.save();var e=y.series.pie.innerRadius>1?y.series.pie.innerRadius:_*y.series.pie.innerRadius;t.globalCompositeOperation="destination-out",t.beginPath(),t.fillStyle=y.series.pie.stroke.color,t.arc(0,0,e,0,2*Math.PI,!1),t.fill(),t.closePath(),t.restore(),t.save(),t.beginPath(),t.strokeStyle=y.series.pie.stroke.color,t.arc(0,0,e,0,2*Math.PI,!1),t.stroke(),t.closePath(),t.restore()}}function l(t,e){for(var i=!1,n=-1,r=t.length,s=r-1;++n<r;s=n)(t[n][1]<=e[1]&&e[1]<t[s][1]||t[s][1]<=e[1]&&e[1]<t[n][1])&&e[0]<(t[s][0]-t[n][0])*(e[1]-t[n][1])/(t[s][1]-t[n][1])+t[n][0]&&(i=!i);return i}function h(t,i){for(var n,r,s=e.getData(),a=e.getOptions(),o=a.series.pie.radius>1?a.series.pie.radius:_*a.series.pie.radius,h=0;h<s.length;++h){var c=s[h];if(c.pie.show){if(S.save(),S.beginPath(),S.moveTo(0,0),S.arc(0,0,o,c.startAngle,c.startAngle+c.angle/2,!1),S.arc(0,0,o,c.startAngle+c.angle/2,c.startAngle+c.angle,!1),S.closePath(),n=t-x,r=i-w,S.isPointInPath){if(S.isPointInPath(t-x,i-w))return S.restore(),{datapoint:[c.percent,c.data],dataIndex:0,series:c,seriesIndex:h}}else{var u=o*Math.cos(c.startAngle),d=o*Math.sin(c.startAngle),p=o*Math.cos(c.startAngle+c.angle/4),f=o*Math.sin(c.startAngle+c.angle/4),g=o*Math.cos(c.startAngle+c.angle/2),m=o*Math.sin(c.startAngle+c.angle/2),v=o*Math.cos(c.startAngle+c.angle/1.5),b=o*Math.sin(c.startAngle+c.angle/1.5),y=o*Math.cos(c.startAngle+c.angle),k=o*Math.sin(c.startAngle+c.angle),T=[[0,0],[u,d],[p,f],[g,m],[v,b],[y,k]],C=[n,r];if(l(T,C))return S.restore(),{datapoint:[c.percent,c.data],dataIndex:0,series:c,seriesIndex:h}}S.restore()}}return null}function c(t){d("plothover",t)}function u(t){d("plotclick",t)}function d(t,i){var n=e.offset(),r=parseInt(i.pageX-n.left),s=parseInt(i.pageY-n.top),a=h(r,s);if(y.grid.autoHighlight)for(var o=0;o<T.length;++o){var l=T[o];l.auto!=t||a&&l.series==a.series||f(l.series)}a&&p(a.series,t);var c={pageX:i.pageX,pageY:i.pageY};b.trigger(t,[c,a])}function p(t,i){var n=g(t);n==-1?(T.push({series:t,auto:i}),e.triggerRedrawOverlay()):i||(T[n].auto=!1)}function f(t){null==t&&(T=[],e.triggerRedrawOverlay());var i=g(t);i!=-1&&(T.splice(i,1),e.triggerRedrawOverlay())}function g(t){for(var e=0;e<T.length;++e){var i=T[e];if(i.series==t)return e}return-1}function m(t,e){function i(t){t.angle<=0||isNaN(t.angle)||(e.fillStyle="rgba(255, 255, 255, "+n.series.pie.highlight.opacity+")",e.beginPath(),Math.abs(t.angle-2*Math.PI)>1e-9&&e.moveTo(0,0),e.arc(0,0,r,t.startAngle,t.startAngle+t.angle/2,!1),e.arc(0,0,r,t.startAngle+t.angle/2,t.startAngle+t.angle,!1),e.closePath(),e.fill())}var n=t.getOptions(),r=n.series.pie.radius>1?n.series.pie.radius:_*n.series.pie.radius;e.save(),e.translate(x,w),e.scale(1,n.series.pie.tilt);for(var s=0;s<T.length;++s)i(T[s].series);o(e),e.restore()}var v=null,b=null,y=null,_=null,x=null,w=null,k=!1,S=null,T=[];e.hooks.processOptions.push(function(t,e){e.series.pie.show&&(e.grid.show=!1,"auto"==e.series.pie.label.show&&(e.legend.show?e.series.pie.label.show=!1:e.series.pie.label.show=!0),"auto"==e.series.pie.radius&&(e.series.pie.label.show?e.series.pie.radius=.75:e.series.pie.radius=1),e.series.pie.tilt>1?e.series.pie.tilt=1:e.series.pie.tilt<0&&(e.series.pie.tilt=0))}),e.hooks.bindEvents.push(function(t,e){var i=t.getOptions();i.series.pie.show&&(i.grid.hoverable&&e.unbind("mousemove").mousemove(c),i.grid.clickable&&e.unbind("click").click(u))}),e.hooks.processDatapoints.push(function(t,e,i,n){var s=t.getOptions();s.series.pie.show&&r(t,e,i,n)}),e.hooks.drawOverlay.push(function(t,e){var i=t.getOptions();i.series.pie.show&&m(t,e)}),e.hooks.draw.push(function(t,e){var i=t.getOptions();i.series.pie.show&&a(t,e)})}var i=10,n=.95,r={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(t,e){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+e.color+";'>"+t+"<br/>"+Math.round(e.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};t.plot.plugins.push({init:e,options:r,name:"pie",version:"1.1"})}(jQuery);