- team_id = @individual_result_list.first.team_id
- team_name = @individual_result_list.first.team.get_full_name
- event_list = []
= render( partial: 'meeting_header' )
= render( partial: 'tabs_and_radio_title' )
- cache( cache_key_for_meeting( 'show_swimmer_results', @meeting.id, @max_mir_updated_at, team_id, @swimmer.id) ) do
  .row-fluid.span12
    .span3.alert.alert-success
      %h4
        %a{'id'=>"swimmer#{@swimmer.id}", 'href'=>"#{ swimmer_radio_path(:id=>@swimmer.id) }", 'data-toggle' => 'tooltip', 'title' => I18n.t('radiography.radio_tab_tooltip')}
          = @swimmer.get_full_name
    .span1
      %h4= @swimmer.year_of_birth
    .span1
      %h4= @individual_result_list.first.get_category_and_gender_short
    .span2
      - badge = @individual_result_list.first.badge
      %h4= badge ? "#{I18n.t('badge.short')} #{badge.number}" : "(#{I18n.t('badge.short')} ?)"
    .span5
      %h4
        %a{'id'=>"swimmer#{@swimmer.id}", 'href'=>"#{ meeting_show_team_results_path(:id=>@meeting.id, :team_id=>team_id) }", 'data-toggle' => 'tooltip', 'title' => I18n.t('meeting.show_team_results_tooltip')}
          = team_name
  .row-fluid
    .span10
  .row-fluid
    .span6
      %table.table.table-striped.table-bordered.table-hover.table-condensed
        %tbody
          %tr
            %td.goggles-centeralign{'colspan'=>'4'}
              %i= I18n.t('meeting.results')
            %td.goggles-centeralign{'colspan'=>'2'}
              %i= I18n.t('meeting.scores')
          %tr
            %td
            %td.goggles-centeralign{'colspan'=>'2'}
              %i= I18n.t('meeting.rank')
            %td.goggles-centeralign
              %i= I18n.t('meeting.timing')
            %td.goggles-centeralign
              %i= I18n.t('meeting.standard')
            %td.goggles-centeralign
              %i= I18n.t('meeting.meeting')

          - if @individual_result_list.size > 0
            - pool_type = @individual_result_list.first.pool_type
            - sbf = SwimmerBestFinder.new( @swimmer )

          - @individual_result_list.each do |individual_result|
            - mir = MeetingIndividualResultDecorator.decorate( individual_result )
            - event_type = mir.event_type
            %tr
              %td
                %b= mir.get_event_type
              %td.goggles-rightalign
                = mir.get_rank_description
              %td
                = mir.show_any_rank_medal()
              %td.goggles-rightalign
                = mir.get_timing
              %td.goggles-rightalign
                = mir.get_formatted_standard_points(true)
              %td.goggles-rightalign
                = mir.get_formatted_individual_points(true)
    .span3
      %table.table.table-striped.table-bordered.table-hover.table-condensed
        %tbody
          %tr
            %td.goggles-centeralign{'colspan'=>'3'}
              %i= I18n.t('meeting.personal_records')
          %tr
            %td
            %td.goggles-centeralign
              %i= I18n.t('meeting.personal_best')
            %td
              %i= I18n.t('meeting.seasonal_best')
          - @individual_result_list.each do |individual_result|
            - mir = MeetingIndividualResultDecorator.decorate( individual_result )
            - event_type = mir.event_type
            - if !event_list.include?( event_type.code )
              - event_list << event_type.code
              %tr
                %td
                  = mir.get_event_type
                %td.goggles-rightalign
                  - personal_best = sbf.get_best_for_event( event_type, pool_type )
                  - if personal_best
                    = personal_best.to_s
                  - else
                    = ''
                %td.goggles-rightalign
                  - seasonal_best = sbf.get_involved_season_best_for_event( sbf.get_contemporary_seasons_involved_into( @meeting.season ), event_type, pool_type )
                  - if seasonal_best
                    = seasonal_best.to_s
                  - else
                    = ''

  .row-fluid
    .span8
  .row-fluid
    .span8
      %table.table.table-striped.table-bordered.table-hover.table-condensed
        %tbody
          %tr
            %td.goggles-centeralign{'colspan'=>'2'}
              %i= I18n.t('meeting.previous_editions')
            %td.goggles-centeralign{'colspan'=>'10'}
              %i= I18n.t('meeting.results')
          - @swimmer.meetings.for_code( @meeting.code ).uniq.sort_by_date( 'DESC' ).each do |prev_meeting|
            - if prev_meeting.id != @meeting.id
              %tr
                %td
                  = prev_meeting.decorate.get_linked_name
                %td
                  = prev_meeting.get_scheduled_date
                - prev_meeting.meeting_individual_results.for_swimmer( @swimmer ).sort_by_event_order.each do |mir|
                  - if event_list.include?( mir.event_type.code )
                    %td
                      %b= mir.get_event_type
                    %td.goggles-rightalign
                      %b= mir.get_timing
                  - else
                    %td
                      = mir.get_event_type
                    %td.goggles-rightalign
                      = mir.get_timing
              
