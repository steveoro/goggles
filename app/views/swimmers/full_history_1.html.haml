= render( partial: 'tabs_and_title' )
- cache( cache_key_for_swimmer( 'full_history_1', @swimmer.id, @max_updated_at ) ) do
  .col-xs-12#pageTop
    - @swimmer_career.pool_types.each_value do |pool_data|
      .col-xs-6.graph-container-half
        .graph-placeholder-full{ 'id' => "pie#{pool_data.pool_code}" }
        %br/
        .col-xs-offset-4
          %ul.nav.nav-pills
            %li
              = link_to("##{pool_data.pool_code}", {'data-turbolinks'=>'false'}) do
                = pool_data.description

  .col-xs-12.goggles-category-gap#full_history_1
  - @swimmer_career.pool_types.each_pair do |pool_code, pool|
    .col-xs-12
      .goggles-category-gap{ 'id' => "#{pool_code}" }
        %h3
          = pool.description
          = link_to("#pageTop", {'data-turbolinks'=>'false', 'data-toggle'=>'tooltip', 'title'=>I18n.t('top_of_page')}) do
            = image_tag('bullet_arrow_up.png')

    .col-xs-12.table-responsive
      - prev_cat = 'none'
      %table.table.table-striped.table-bordered.table-hover.table-condensed
        %tbody
          - event_list = pool.get_events
          - pool.meetings.each_value do |meeting|
            - if prev_cat != meeting.category_code
              %tr{'class'=>'info'}
                %td.goggles-centeralign
                  %b= I18n.t('meeting.meeting')
                - event_list.each do |event_code|
                  %td.goggles-centeralign
                    %b= event_code
              - prev_cat = meeting.category_code
            = render( partial: 'swimmer_career_meeting_row', locals: { meeting: meeting, event_list: event_list } )

  .col-xs-12.goggles-category-gap
    &nbsp;

  :javascript
    // Custom label formatter:
    function labelFormatter(label, series) {
      return "<div style='font-size:8pt; text-align:center; padding:2px; color:white;'>" +
             label + "<br/>" + Math.round(series.percent) + "%</div>";
    }

    /**
     * Defines and plots the pie graphs for #full_history_1
     *
     * [Steve, 20161014] Keep always functions names unique to avoid clash.
     */
    function plotFullHistory1Charts() {
      var txt25 = "#{ escape_javascript( @swimmer_career.get_pool_events('25').to_json.html_safe ) }";
      var txt50 = "#{ escape_javascript( @swimmer_career.get_pool_events('50').to_json.html_safe ) }";
      // DEBUG
      //console.log( txt25 );
      //console.log( txt50 );
      var data25 = JSON.parse( txt25 );
      var data50 = JSON.parse( txt50 );
      var options = {
          series: {
              pie: {
                  show: true,
                  radius: 1,
                  // tilt: 0.5,
                  label: {
                      show: true,
                      radius: 3/4,
                      formatter: labelFormatter,
                      background: { opacity: 0.5 }
                  }
              }
          },
          grid: {
              hoverable: true
          },
          legend: { show: false }
      };

      $.plot( "#pie25", data25, options );
      $.plot( "#pie50", data50, options );
    }

    $( function() {
      if ( $('#full_history_1')['length'] == 1 ) {
        plotFullHistory1Charts();
      }
    });
